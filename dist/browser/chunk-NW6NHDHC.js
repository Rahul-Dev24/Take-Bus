import{a as d,b as v}from"./chunk-AXSQGWF4.js";import{a as b}from"./chunk-RO2DPKCW.js";import{d as x,o as w}from"./chunk-23TUFUZG.js";import{Cb as S,P as h,U as p,d as I,ma as m,qa as k}from"./chunk-SFNGWMRT.js";var u=class extends Error{};u.prototype.name="InvalidTokenError";function D(o){return decodeURIComponent(atob(o).replace(/(.)/g,(c,e)=>{let t=e.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function E(o){let c=o.replace(/-/g,"+").replace(/_/g,"/");switch(c.length%4){case 0:break;case 2:c+="==";break;case 3:c+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return D(c)}catch{return atob(c)}}function U(o,c){if(typeof o!="string")throw new u("Invalid token specified: must be a string");c||(c={});let e=c.header===!0?0:1,t=o.split(".")[e];if(typeof t!="string")throw new u(`Invalid token specified: missing part #${e+1}`);let r;try{r=E(t)}catch(s){throw new u(`Invalid token specified: invalid base64 for part #${e+1} (${s.message})`)}try{return JSON.parse(r)}catch(s){throw new u(`Invalid token specified: invalid json for part #${e+1} (${s.message})`)}}var y=(()=>{class o{constructor(e,t){this.document=e,this.platformId=t,this.documentIsAccessible=w(this.platformId)}static getCookieRegExp(e){let t=e.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+t+"|;\\s*"+t+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(e){try{return decodeURIComponent(e)}catch{return e}}check(e){return this.documentIsAccessible?(e=encodeURIComponent(e),o.getCookieRegExp(e).test(this.document.cookie)):!1}get(e){if(this.documentIsAccessible&&this.check(e)){e=encodeURIComponent(e);let r=o.getCookieRegExp(e).exec(this.document.cookie);return r[1]?o.safeDecodeURIComponent(r[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let e={},t=this.document;return t.cookie&&t.cookie!==""&&t.cookie.split(";").forEach(r=>{let[s,n]=r.split("=");e[o.safeDecodeURIComponent(s.replace(/^ /,""))]=o.safeDecodeURIComponent(n)}),e}set(e,t,r,s,n,a,f,C){if(!this.documentIsAccessible)return;if(typeof r=="number"||r instanceof Date||s||n||a||f){let g={expires:r,path:s,domain:n,secure:a,sameSite:f||"Lax",partitioned:C};this.set(e,t,g);return}let l=encodeURIComponent(e)+"="+encodeURIComponent(t)+";",i=r||{};if(i.expires)if(typeof i.expires=="number"){let g=new Date(new Date().getTime()+i.expires*1e3*60*60*24);l+="expires="+g.toUTCString()+";"}else l+="expires="+i.expires.toUTCString()+";";i.path&&(l+="path="+i.path+";"),i.domain&&(l+="domain="+i.domain+";"),i.secure===!1&&i.sameSite==="None"&&(i.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${e} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),i.secure&&(l+="secure;"),i.sameSite||(i.sameSite="Lax"),l+="sameSite="+i.sameSite+";",i.partitioned&&(l+="Partitioned;"),this.document.cookie=l}delete(e,t,r,s,n="Lax"){if(!this.documentIsAccessible)return;let a=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(e,"",{expires:a,path:t,domain:r,secure:s,sameSite:n})}deleteAll(e,t,r,s="Lax"){if(!this.documentIsAccessible)return;let n=this.getAll();for(let a in n)n.hasOwnProperty(a)&&this.delete(a,e,t,r,s)}static{this.\u0275fac=function(t){return new(t||o)(p(x),p(k))}}static{this.\u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var G=(()=>{class o{constructor(e,t,r){this.http=e,this.cookieService=t,this.alertService=r,this.authToken="token",this.token=m(this.cookieService.get(this.authToken)),this.role=m(localStorage.getItem("role")||"user"),this.userId=m(localStorage.getItem("user")||""),this.permission=m(localStorage.getItem("permission")||""),this.isLoggedIn$=S(()=>{let s=localStorage.getItem("user");if(this.userId(),!s)return!1;let n=s?JSON.parse(s):{},a=Math.floor(Date.now()/1e3);return n.exp<a?(this.alertService.showInfo("Token Expired."),this.logout(),!1):!0})}regesterUser(e,t="user"){return this.http.post(`${d?.BASE_URL}/signup/${t}`,e)}loginUser(e,t){return this.http.post(`${d?.BASE_URL}/login`,{email:e,password:t})}otpVerify(e,t){return this.http.post(`${d?.BASE_URL}/verifyOtp`,{otp:e,userId:t})}setCookie(e){return I(this,null,function*(){this.cookieService.set(this.authToken,e);let t=this.deCriptToken(e);yield localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("role",t.role),localStorage.setItem("userId",t.id),localStorage.setItem("permission",t.permission),this.role.set(t.role),this.userId.set(t.id),this.permission.set(t.permission)})}deCriptToken(e){return U(e)}logout(){localStorage.removeItem("user"),localStorage.removeItem("role"),localStorage.removeItem("userId"),localStorage.removeItem("permission"),localStorage.removeItem("profileImg"),this.token.set(""),this.role.set("user"),this.userId.set(""),this.permission.set(""),this.cookieService.delete(this.authToken,"/")}static{this.\u0275fac=function(t){return new(t||o)(p(b),p(y),p(v))}}static{this.\u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{y as a,G as b};
